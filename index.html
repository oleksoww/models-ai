<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ¤– Multi-AI Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, sans-serif; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 text-white p-6">
  <div class="max-w-2xl mx-auto shadow-2xl rounded-2xl bg-gray-950">
    <div class="p-6 space-y-4">
      <h1 class="text-2xl font-bold text-center">ğŸ¤– Multi-AI Chat</h1>

      <!-- WybÃ³r modelu -->
      <select id="modelSelect" class="w-full p-2 rounded bg-gray-700"></select>

      <!-- Pole na API Key -->
      <input id="apiKey" type="password" class="w-full p-2 rounded bg-gray-700" placeholder="Wpisz klucz API" />
      <button id="saveKey" class="w-full p-2 rounded bg-blue-600 hover:bg-blue-500">ğŸ’¾ Zapisz klucz</button>

      <!-- Okno czatu -->
      <div id="chatWindow" class="h-80 overflow-y-auto bg-gray-900 p-4 rounded space-y-2"></div>

      <!-- Input do wiadomoÅ›ci -->
      <div class="flex gap-2">
        <input id="userInput" class="flex-1 p-2 rounded bg-gray-700" placeholder="Napisz wiadomoÅ›Ä‡..." />
        <button id="sendBtn" class="p-2 rounded bg-green-600 hover:bg-green-500">ğŸ“© WyÅ›lij</button>
      </div>
    </div>
  </div>

  <script>
    const MODELS = {
      "gpt-4": { label: "ChatGPT 4", apiUrl: "https://api.openai.com/v1/chat/completions", provider: "openai" },
      "gpt-3.5-turbo": { label: "ChatGPT 3.5", apiUrl: "https://api.openai.com/v1/chat/completions", provider: "openai" },
      "gemini-pro": { label: "Gemini Pro", apiUrl: "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent", provider: "google" },
      "claude-3": { label: "Claude 3", apiUrl: "https://api.anthropic.com/v1/messages", provider: "anthropic" },
      "llama-2": { label: "LLaMA 2", apiUrl: "https://api.llama.meta/v1/chat", provider: "meta" },
    };

    const modelSelect = document.getElementById("modelSelect");
    const apiKeyInput = document.getElementById("apiKey");
    const chatWindow = document.getElementById("chatWindow");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const saveKeyBtn = document.getElementById("saveKey");

    // ZaÅ‚aduj modele do selecta
    for (const [key, m] of Object.entries(MODELS)) {
      const opt = document.createElement("option");
      opt.value = key;
      opt.textContent = m.label;
      modelSelect.appendChild(opt);
    }
    modelSelect.value = "gpt-4";

    function getSavedKey(model) {
      return localStorage.getItem(`apiKey_${model}`) || "";
    }

    apiKeyInput.value = getSavedKey(modelSelect.value);

    saveKeyBtn.onclick = () => {
      localStorage.setItem(`apiKey_${modelSelect.value}`, apiKeyInput.value);
      alert("âœ… Klucz zapisany dla " + MODELS[modelSelect.value].label);
    };

    async function sendMessage() {
      const model = modelSelect.value;
      const apiKey = apiKeyInput.value;
      const input = userInput.value.trim();
      if (!apiKey) {
        alert("âŒ Podaj swÃ³j klucz API dla " + MODELS[model].label);
        return;
      }
      if (!input) return;

      addMessage("user", input);
      userInput.value = "";

      try {
        let body;
        let headers = { "Content-Type": "application/json" };
        const { apiUrl, provider } = MODELS[model];

        if (provider === "openai") {
          headers["Authorization"] = `Bearer ${apiKey}`;
          body = JSON.stringify({ model, messages: [{ role: "user", content: input }] });
        } else if (provider === "google") {
          body = JSON.stringify({ contents: [{ parts: [{ text: input }] }] });
        } else if (provider === "anthropic") {
          headers["x-api-key"] = apiKey;
          body = JSON.stringify({ model, max_tokens: 512, messages: [{ role: "user", content: input }] });
        } else if (provider === "meta") {
          headers["Authorization"] = `Bearer ${apiKey}`;
          body = JSON.stringify({ messages: [{ role: "user", content: input }] });
        }

        const res = await fetch(provider === "google" ? `${apiUrl}?key=${apiKey}` : apiUrl, { method: "POST", headers, body });
        const data = await res.json();
        let reply = "(Brak odpowiedzi)";

        if (provider === "openai") reply = data.choices?.[0]?.message?.content || reply;
        if (provider === "google") reply = data.candidates?.[0]?.content?.parts?.[0]?.text || reply;
        if (provider === "anthropic") reply = data.content?.[0]?.text || reply;
        if (provider === "meta") reply = data.choices?.[0]?.message?.content || reply;

        addMessage("assistant", reply);
      } catch (err) {
        console.error(err);
        alert("âš ï¸ BÅ‚Ä…d poÅ‚Ä…czenia z API");
      }
    }

    function addMessage(role, text) {
      const div = document.createElement("div");
      div.className = `p-2 rounded-lg max-w-[75%] ${role === "user" ? "bg-blue-600 ml-auto" : "bg-gray-700"}`;
      div.textContent = text;
      chatWindow.appendChild(div);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    sendBtn.onclick = sendMessage;
    userInput.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });
  </script>
</body>
</html>
